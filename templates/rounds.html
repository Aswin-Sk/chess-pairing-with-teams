<!doctype html>
<html>
<head>
  <title>Rounds & Matches</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container py-4">
    <a href="{{ url_for('index') }}" class="btn btn-link">&larr; Back</a>
    <h2>Rounds & Matches</h2>

    {% for r in rounds %}
    <div class="card mb-3">
      <div class="card-body">
        <h5>Round {{ r.number }}</h5>
        <table class="table table-sm">
          <thead><tr><th>#</th><th>Player 1</th><th>Player 2</th><th>Score</th><th>Action</th></tr></thead>
          <tbody>
            {% for m in matches[r.id] %}
            <tr>
              <td>{{ loop.index }}</td>
              <td>{{ m.p1.name }} ({{ m.p1.team }})</td>
              <td>{% if m.p2 %}{{ m.p2.name }} ({{ m.p2.team }}){% else %}<em>Bye</em>{% endif %}</td>
              <td>
                {% if m.finished %}
                  {{ m.p1_score }} - {{ m.p2_score }}
                {% else %}
                  -
                {% endif %}
              </td>
              <td>
                {% if not m.finished and m.p2_id is not none %}
                    <form method="post" action="{{ url_for('report_result', match_id=m.id) }}" class="d-inline-flex">
                        
                        <select name="result" required class="form-select form-select-sm me-2">
                            <option value="" disabled selected>Report Result</option>
                            
                            <option value="1.0-0.0">Win for {{ m.p1.name }} (1 - 0)</option>
                            <option value="0.0-1.0">Win for {{ m.p2.name }} (0 - 1)</option>
                            <option value="0.5-0.5">Draw (0.5 - 0.5)</option>
                            
                        </select>
                        
                        <button type="submit" class="btn btn-sm btn-success">Report</button>
                    </form>
                {% elif m.finished and m.p2_id is not none %}
                    <form method="post" action="{{ url_for('report_result', match_id=m.id) }}" class="d-inline-flex">
                        
                        <select name="result" required class="form-select form-select-sm me-2">
                            
                            {% set current_result = m.p1_score|string + '-' + m.p2_score|string %}
                            
                            <option value="1.0-0.0" {% if current_result == "1.0-0.0" %}selected{% endif %}>
                                Win for {{ m.p1.name }} (1.0 - 0.0)
                            </option>
                            
                            <option value="0.0-1.0" {% if current_result == "0.0-1.0" %}selected{% endif %}>
                                Win for {{ m.p2.name }} (0.0 - 1.0)
                            </option>
                            
                            <option value="0.5-0.5" {% if current_result == "0.5-0.5" %}selected{% endif %}>
                                Draw (0.5 - 0.5)
                            </option>
                            
                        </select>
                        
                        <button type="submit" class="btn btn-sm btn-success">Update</button>
                    </form>
                {% elif m.finished and m.p2_id is none %}
                    {{ m.p1.name }} receives a BYE (1.0)
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    {% endfor %}

  </div>
</body>
</html>
